# Python聚类热图clustermap

> **聚类热图**可以简单理解为:使用距离算法将距离相近的东西成簇聚为一类。
> 本篇使用python中**seaborn.clustermap**绘制聚类热图（clustermap）。

## **本文将了解到什么？**

> 1、成品聚类热图（clustermap）展示
> 2、绘图数据集准备
> 3、 seaborn.clustermap绘制聚类热图（clustermap）
> 3.0 聚类热图函数seaborn.clustermap语法
> 3.1 默认参数绘图
> 3.2 pivot_kws：辅助选择data中某一部分数据绘图
> 3.3 method：聚类算法
> 3.4 metric：簇之间距离选择
> 3.5 figsize：热图的宽和高设置
> 3.6 cbar_kws：图例设置
> 3.7 row_cluster、col_cluster：行列聚类开关
> 3.8 row_colors: y轴方向绘制分类色条
> 3.9 col_colors: x轴方向绘制分类色条
> 3.10 cbar_pos：图例位置、宽、高设置
> 3.11 tree_kws：各个簇之间连线特性设置
> 3.12 cmap：热图填充色colormap设置
> 3.13 annot、annot_kws：显示文本、文本属性设置
> 3.14 其它参数设置

---

**1、成品聚类热图（clustermap）展示**

![](https://pic4.zhimg.com/80/v2-90a3864cae1a90fe9a94b326ba702def_1440w.jpg)

---

## **2、绘图数据集准备**

依旧使用sklearn中鸢尾花iris数据集，数据集详细介绍请戳：**[鸢尾花iris数据集详细介绍](https://link.zhihu.com/?target=https%3A//mp.weixin.qq.com/s%3F__biz%3DMzUwOTg0MjczNw%3D%3D%26mid%3D2247484528%26idx%3D2%26sn%3D48cfeb144ee621ecbbe07a81d0fab220%26chksm%3Df90d402ece7ac93812f70a97e7374e555d38077dfe1fbb9a0506d17133c6aea891ce54a67e91%26scene%3D158%23rd)**

```python
import matplotlib.pyplot as plt
import numpy as np
import pandas as pd
from pandas import Series,DataFrame
import seaborn as sns
import palettable

plt.rcParams['font.sans-serif']=['SimHei']  # 用于显示中文
plt.rcParams['axes.unicode_minus'] = False  # 用于显示中文

from sklearn import datasets 
iris=datasets.load_iris()
x, y = iris.data, iris.target
pd_iris = pd.DataFrame(np.hstack((x, y.reshape(150, 1))),columns=['sepal length(cm)','sepal width(cm)','petal length(cm)','petal width(cm)','class'] )
```

查看数据集前五行

```python
pd_iris.head()
```

![](https://pic3.zhimg.com/80/v2-232ec7b3fecb39aa0aa2703270eaaeea_1440w.jpg)

数据集简单统计

```text
pd_iris.describe()
```

![](https://pic1.zhimg.com/80/v2-c855f2b925f678c5e7f985b1591ae7ac_1440w.jpg)

---

## **3、 seaborn.clustermap绘制聚类热图（clustermap）**

## **3.0 聚类热图函数seaborn.clustermap语法**

```text
seaborn.clustermap(data, pivot_kws=None, method='average', metric='euclidean', z_score=None, standard_scale=None, figsize=(10, 10), cbar_kws=None, row_cluster=True, col_cluster=True, row_linkage=None, col_linkage=None, row_colors=None, col_colors=None, mask=None, dendrogram_ratio=0.2, colors_ratio=0.03, cbar_pos=(0.02, 0.8, 0.05, 0.18), tree_kws=None, **kwargs)
```

## **3.1 默认参数绘图**

```python
plt.figure(dpi=200)
sns.clustermap(data=pd_iris,#仅仅需传入绘图数据集
              )
```

![](https://pic1.zhimg.com/80/v2-2433e90d97eb5c7e2de4ec750add2e10_1440w.jpg)

## **3.2 pivot_kws：辅助选择data中某一部分数据绘图**

* 改参数使用可参考：[https://**cmdlinetips.com/2020/01**/heatmaps-with-seaborns-clustermap/](https://link.zhihu.com/?target=https%3A//cmdlinetips.com/2020/01/heatmaps-with-seaborns-clustermap/)

## **3.3 method：聚类算法**

默认为为average算法，可选’single’，’complete’ ,’weighted’,’centroid’,’median’；各算法区别请参考scipy中：**[scipy.cluster.hierarchy.linkage](https://link.zhihu.com/?target=https%3A//docs.scipy.org/doc/scipy/reference/generated/scipy.cluster.hierarchy.linkage.html)**

```text
sns.clustermap(data=pd_iris,
               method='average',#'average'算法
              )
```

![](https://pic1.zhimg.com/80/v2-2433e90d97eb5c7e2de4ec750add2e10_1440w.jpg)

```text
#注意观察y轴方向值的变化
sns.clustermap(data=pd_iris,
               method='single',#'single'算法
              )
```

![](https://pic3.zhimg.com/80/v2-04ae7bc530ba9e14fbdbc03a66bb978a_1440w.jpg)

```text
sns.clustermap(data=pd_iris,
               method='weighted',#'weighted'算法
              )
```

![](https://pic4.zhimg.com/80/v2-725557c7b38985c682c83abd67c5b76b_1440w.jpg)

## **3.4 metric：簇之间距离选择**

> 默认为欧式距离euclidean，可选距离： ‘braycurtis’, ‘canberra’, ‘chebyshev’, ‘cityblock’, ‘correlation’, ‘cosine’, ‘dice’,
> ‘euclidean’, ‘hamming’, ‘jaccard’, ‘jensenshannon’, ‘kulsinski’, ‘mahalanobis’, ‘matching’, ‘minkowski’,
> ‘rogerstanimoto’, ‘russellrao’, ‘seuclidean’, ‘sokalmichener’, ‘sokalsneath’, ‘sqeuclidean’, ‘yule’.各个距离之间区别，scipy中有详细介绍：**[scipy.spatial.distance.pdist](https://link.zhihu.com/?target=https%3A//docs.scipy.org/doc/scipy/reference/generated/scipy.spatial.distance.pdist.html)**

```text
sns.clustermap(data=pd_iris,
               metric='euclidean',#欧式距离'euclidean'
              )
```

![](https://pic1.zhimg.com/80/v2-2433e90d97eb5c7e2de4ec750add2e10_1440w.jpg)

```text
#注意右侧值的变化
sns.clustermap(data=pd_iris,
               metric='braycurtis',#Bray-Curtis距离
              )
```

![](https://pic4.zhimg.com/80/v2-d12d1f8b48da8e8289165abc34b57a7b_1440w.jpg)

## **3.5 figsize：热图的宽和高设置**

```text
sns.clustermap(data=pd_iris,
               figsize=(5, 10),          
              )
```

![](https://pic1.zhimg.com/80/v2-f2788c7ba6703eeba972373de952c914_1440w.jpg)

## **3.6 cbar_kws：图例设置**

方法类似普通heatmap，不赘述，参考： **[热图图例详细设置](https://link.zhihu.com/?target=https%3A//mp.weixin.qq.com/s%3F__biz%3DMzUwOTg0MjczNw%3D%3D%26mid%3D2247485375%26idx%3D1%26sn%3Dbe29296af9b63a2b6379dbe89700386d%26chksm%3Df90d43e1ce7acaf7f1507762d40178023106afd6910e2ae3f3f7bb9f14db5c289cfbf0a81922%26token%3D1588396102%26lang%3Dzh_CN%23rd)**

## **3.7 row_cluster、col_cluster：行列聚类开关**

```text
sns.clustermap(data=pd_iris,
               row_cluster=False, #行方向不聚类
               col_cluster=True, #列方向聚类
             
              )
```

![](https://pic3.zhimg.com/80/v2-edfd033a288551cebf0f70046893820e_1440w.jpg)

## **3.8 row_colors: y轴方向绘制分类色条**

```text
#左侧颜色条
row_c = dict(zip(pd_iris['class'].unique(), ['green','yellow','pink']))
sns.clustermap(data=pd_iris,
               row_colors=pd_iris['class'].map(row_c), #行方向聚类用颜色区分不同类             
              )
```

![](https://pic4.zhimg.com/80/v2-e518f5947b0c1cfb9270e3b4c3edcd97_1440w.jpg)

## **3.9 col_colors: x轴方向绘制分类色条**

![](https://pic4.zhimg.com/80/v2-eb713a0b53af2b7ca8fa9a56bd691ab3_1440w.jpg)

## **3.10 cbar_pos：图例位置、宽、高设置**

```text
sns.clustermap(data=pd_iris,
               cbar_pos=(0.02, 0.8, 0.05, 0.18), #(left, bottom, width, height)
             
              )
```

![](https://pic1.zhimg.com/80/v2-2433e90d97eb5c7e2de4ec750add2e10_1440w.jpg)

```text
#图例向右，向下移动
sns.clustermap(data=pd_iris,
               cbar_pos=(0.12, 0.4, 0.05, 0.18), 
             
              )
```

![](https://pic1.zhimg.com/80/v2-c33a72f1d5cd6d6c0641b1214e8fe98c_1440w.jpg)

## **3.11 tree_kws：各个簇之间连线特性设置**

线型设置参考：**[python中line属性设置](https://link.zhihu.com/?target=https%3A//mp.weixin.qq.com/s%3F__biz%3DMzUwOTg0MjczNw%3D%3D%26mid%3D2247484192%26idx%3D2%26sn%3D66b5bdab9591e4652576d9298c18b6db%26chksm%3Df90d477ece7ace682612807580b0b14790c4ab9b4bbf13a6f7704aeeb1c793f8256141351982%26scene%3D158%23rd)**

```text
sns.clustermap(data=pd_iris,
               tree_kws={'linestyles':'dashed',#线型
                        'colors':'steelblue',#线色
                        'linewidths':2},#线宽 
             
              )
```

![](https://pic4.zhimg.com/80/v2-77f03f50fd5012830a496a5cb7b15cef_1440w.jpg)

## **3.12 cmap：热图填充色colormap设置**

colormap设置参考：**[python中colormap详细设置](https://link.zhihu.com/?target=https%3A//mp.weixin.qq.com/s%3F__biz%3DMzUwOTg0MjczNw%3D%3D%26mid%3D2247485375%26idx%3D1%26sn%3Dbe29296af9b63a2b6379dbe89700386d%26chksm%3Df90d43e1ce7acaf7f1507762d40178023106afd6910e2ae3f3f7bb9f14db5c289cfbf0a81922%26scene%3D158%23rd)**

![](https://pic4.zhimg.com/80/v2-f33c3f8edf7a870824ba824776867c93_1440w.jpg)

## **3.13 annot、annot_kws：显示文本、文本属性设置**

```text
sns.clustermap(data=pd_iris,
               annot=True,#默认为False，当为True时，在每个格子写入data中数据
               figsize=(15, 30),#热图宽和高
               annot_kws={'size':12,'weight':'normal', 'color':'red'},#设置格子中文本的大小、粗细、颜色
               cmap=palettable.cartocolors.diverging.ArmyRose_7.mpl_colors,
              )
sns.set(font_scale=1.5)#热图及color bar中刻度标签值字号
```

![](https://pic3.zhimg.com/80/v2-4773f8dc7befff10ab8aa90eba6260ce_1440w.jpg)

## **3.14 其它参数设置**

普通heatmap中方法 ：**[heatmap关键参数详解](https://link.zhihu.com/?target=https%3A//mp.weixin.qq.com/s%3F__biz%3DMzUwOTg0MjczNw%3D%3D%26mid%3D2247485375%26idx%3D1%26sn%3Dbe29296af9b63a2b6379dbe89700386d%26chksm%3Df90d43e1ce7acaf7f1507762d40178023106afd6910e2ae3f3f7bb9f14db5c289cfbf0a81922%26scene%3D158%23rd)**

## **参考资料**

> [http://**seaborn.pydata.org/exam**ples/structured_heatmap.html](https://link.zhihu.com/?target=http%3A//seaborn.pydata.org/examples/structured_heatmap.html)
> [http://**seaborn.pydata.org/gene**rated/seaborn.clustermap.html#seaborn.clustermap](https://link.zhihu.com/?target=http%3A//seaborn.pydata.org/generated/seaborn.clustermap.html%23seaborn.clustermap)
